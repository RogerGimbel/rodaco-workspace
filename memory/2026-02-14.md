# 2026-02-14

## Mission Control v3 (continued from Feb 13)
- Generated comprehensive Lovable prompt with all 25 endpoint response shapes for full 6-page sync
- Saved API reference to `knowledge/projects/mission-control-v3/api-reference.md`
- Roger needs to paste the comprehensive prompt into Lovable for Ops/Agent/Knowledge/Research pages

## Pi Media Stack ‚Äî Homepage Dashboard Fix
- **Problem:** qBittorrent and SABnzbd showing "API Error" on `admin.rogergimbel.dev` (Homepage dashboard)
- **Investigation:** Containers healthy, APIs responding, Homarr (wrong app!) was fine
- **Root cause:** `admin.rogergimbel.dev` is served by **Homepage** container (port 3000), not Homarr
  - Homepage config used host IP `10.0.0.20:8090/8183` to reach qBit/SABnzbd
  - UFW DOCKER-USER firewall (hardened Feb 13) blocks container‚Üíhost loopback traffic
  - So Homepage couldn't reach the services via published ports
- **Fix:** Changed `/mnt/media/config/homepage/services.yaml`:
  - qBit: `http://10.0.0.20:8090` ‚Üí `http://gluetun:8081`
  - SABnzbd: `http://10.0.0.20:8183` ‚Üí `http://gluetun:8080`
- **Red herring:** Temporarily pinned Homarr to 0.15.10 thinking it was the problem ‚Äî reverted to latest
- **Lesson:** Always use Docker internal DNS for container-to-container communication, not host IP + published ports

## OpenClaw
- Upgraded from 2026.2.12 to 2026.2.13

## SOPS/Age Secrets Hardening (Major Deploy)
- **Built and deployed** full SOPS/age encryption for all container secrets
- Audited 17 credentials (12 env vars + 5 file-based)
- Created unified `secrets.enc.yaml` encrypted with age
- Wrote `decrypt-secrets.sh` entrypoint that decrypts to tmpfs at startup
- Updated Dockerfile (added sops v3.9.4 + age v1.2.1)
- Updated docker-compose.yml (removed all plaintext secret env vars)
- GitHub PAT authenticated via `gh auth login`
- Pushed all workspace changes to GitHub

### üêõ BUG: `/run/secrets` Permission Failure
- **Symptom:** Container crash-looped after SOPS migration deploy
- **Root cause:** `decrypt-secrets.sh` tried to `mkdir /run/secrets/` but container runs as uid 1000 (node). `/run` is a root-owned tmpfs mounted with mode `755` ‚Äî node user cannot create directories there.
- **Fix (by Roger via Claude Code):** Changed decrypted secrets directory from `/run/secrets/` to `/tmp/secrets/`. `/tmp` is mounted with mode `1777` (world-writable), so uid 1000 can write freely. Same security model (tmpfs = RAM only), just a different mount point.
- **Also fixed:** Added `age-key.txt` and `*.bak` to `.gitignore`
- **Lesson:** NEVER use `/run` for user-writable files in containers running as non-root. Use `/tmp` instead. Both are tmpfs (RAM-only, no disk persistence), but `/tmp` is world-writable.

## Audit Log
- [14:00] EXEC: SSH Pi ‚Äî investigated container health, ports, logs
- [14:25] FILE: Modified `/mnt/media/config/homepage/services.yaml` (port URLs)
- [14:25] EXEC: Reverted Homarr from 0.15.10 back to latest
- [16:55] FILE: Updated memory/active-tasks.md, MEMORY.md, knowledge files
- [18:00] EXEC: Phase 1 credential audit (17 secrets found)
- [18:20] EXEC: SSH ‚Äî created secrets.yaml, encrypted with SOPS/age
- [18:22] FILE: Wrote decrypt-secrets.sh, updated Dockerfile + docker-compose.yml
- [18:25] EXEC: Docker build (--no-cache, ~20 min on 2018 MacBook)
- [18:45] EXEC: Docker compose up ‚Äî container crashed (permissions bug)
- [20:00] Roger + Claude Code fixed /run ‚Üí /tmp, pushed to GitHub
- [20:45] Container running stable with full SOPS encryption
- [20:55] FILE: Updated MEMORY.md, knowledge/intel-macbook/summary.md with lesson
