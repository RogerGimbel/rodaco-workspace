# 2026-02-05 - Daily Log

## OpenClaw Memory Backend Migration

### QMD Evaluation & Removal
- **Problem:** QMD's local LLM features (query expansion, reranking) too slow on Intel Mac (~30s per search)
- **Root Cause:** Qwen 0.6B models for query expansion/reranking are CPU-intensive
- **Testing Results:**
  | Method | Speed | Notes |
  |--------|-------|-------|
  | `qmd search` (BM25 only) | ~1s | Fast but keyword-only |
  | `qmd vsearch` (vectors) | ~30s | Slow due to LLM query expansion |
  | `qmd query` (full hybrid) | ~30s+ | Slowest, includes reranking |
  | OpenAI embeddings | ~2-5s | Fast semantic search |

- **Decision:** Remove QMD, switch to builtin OpenAI embeddings backend
- **Config Change:** Removed `memory.backend: "qmd"` from openclaw.json

### New Memory Backend Configuration
```json
// No memory config needed - uses builtin defaults
// Provider: openai (text-embedding-3-small)
// Storage: ~/.openclaw/memory/main.sqlite
// Features: vector + FTS (full-text search)
```

### Verification
- `openclaw memory search` now works (~5s response time)
- 30 files, 207 chunks indexed
- Vector + FTS ready
- No more QMD timeouts

## OpenClaw Upgrade: 2026.2.2-3 → 2026.2.3-1

### New Features Explored
1. **Security Audit Commands:**
   - `openclaw security audit` - check config for issues
   - `openclaw security audit --deep` - deep scan
   - `openclaw security audit --fix` - auto-fix

2. **Health Check Commands:**
   - `openclaw doctor` - general health check
   - `openclaw status --all` - full system status

## Security Hardening Applied

### Issues Found by Security Audit
| Issue | Before | After |
|-------|--------|-------|
| Gateway token | 18 chars | 64 chars (openssl rand -hex 32) |
| Haiku in fallbacks | Yes | Removed (prompt injection risk) |
| Env var naming | CLAWDBOT_* | OPENCLAW_* |

### Changes Made
1. **New gateway token:** 64-char hex token in .env
2. **Model fallbacks updated:** Removed Haiku, now Sonnet → Gemini Flash
3. **Env vars renamed:** CLAWDBOT_GATEWAY_TOKEN → OPENCLAW_GATEWAY_TOKEN, etc.
4. **Committed:** docker-compose.yml changes pushed to GitHub

### Final Audit Result
```
Summary: 0 critical · 0 warn · 1 info
```

## Key Learnings

### QMD on Intel Hardware
- QMD's value proposition is local semantic search without API calls
- On Intel Mac, the local LLMs (Qwen 0.6B) are too slow to be practical
- QMD makes sense on faster hardware (M-series Macs, dedicated GPU)
- For Intel Mac, OpenAI embeddings are the better choice

### Memory Backend Comparison
| Feature | QMD | Builtin (OpenAI) |
|---------|-----|------------------|
| Document indexing | Yes | Yes |
| BM25 keyword search | Yes (fast) | Yes (via FTS) |
| Semantic search | Slow (~30s) | Fast (~5s) |
| External API | No | Yes (OpenAI) |
| Complexity | High | Low |

### Security Best Practices
- Use 64+ char tokens for gateway auth
- Avoid smaller models (Haiku) in production with tools
- Run `openclaw security audit` after config changes
- Keep .env out of git (secrets protection)

## Commits
- `462bd98` - Rename deprecated CLAWDBOT_* env vars to OPENCLAW_*
